<?xml version="1.0"?>

<build
	name="ghoghnoos"
	type="live"
	arch="x86_64"
	version="0.0.2"
	subject="base">

	<globals>
		export LD_LIBRARY_PATH="$PROJECT__RFS/usr/lib64/"
		export PKG_CONFIG_PATH="$PROJECT__RFS/usr/lib64/pkgconfig"
	</globals>
	
	<phase seq="1" comment="Base system">
	
		<entry name="linux-4.4.6" type="package/src" seq="1" cdto="yes" download="no" extract="yes">
			<link>https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.4.6.tar.xz</link>
			<filename>linux-4.4.6.tar.xz</filename>
			<version>4.4.6</version>
			<checksum type="md5">efc822dad2149e40cc908718a4fea1d3</checksum>
			<action when="after" seq="1">
				<line verbos="yes">make mrproper</line>
				<line verbos="yes">make defconfig</line>
				<line>sed -i "s/.*CONFIG_DEFAULT_HOSTNAME.*/CONFIG_DEFAULT_HOSTNAME=\"$PROJECT__NAME\"/" .config</line>
				<line verbos="yes">make bzImage</line>
				<line verbos="yes">make headers_install</line>
			</action>
		</entry>
		
		<entry name="glibc-2.24" type="package/src" seq="2" cdto="yes" download="no" extract="yes">
			<link>http://ftp.gnu.org/gnu/glibc/glibc-2.24.tar.xz</link>
			<filename>glibc-2.24.tar.xz</filename>
			<version>2.24</version>
			<checksum type="md5">97dc5517f92016f3d70d83e3162ad318</checksum>
			<action when="after" seq="1">
				<line>mkdir ./glibc_objects</line>
				<line>mkdir ./glibc_installed</line>
				<line>GLIBC_INSTALLED=$(pwd)/glibc_installed</line>
				<line>cd ./glibc_objects</line>
				<line verbos="yes">../configure --prefix= --with-headers=$PROJECT__BLD/linux-4.4.6/usr/include --disable-werror</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install DESTDIR=$GLIBC_INSTALLED</line>
				
				<line>mkdir -vp $PROJECT__RFS/lib</line>
				
				<line>cp $GLIBC_INSTALLED/lib/ld-linux* $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libm.so.6 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libc.so.6 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libresolv.so.2 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libnss_dns.so.2 $PROJECT__RFS/lib</line>
			</action>
		</entry>
		
		<entry name="busybox-1.24.2" type="package/src" seq="3" cdto="yes" download="yes" extract="yes">
			<link>http://busybox.net/downloads/busybox-1.24.2.tar.bz2</link>
			<filename>busybox-1.24.2.tar.bz2</filename>
			<version>1.24.2</version>
			<checksum type="md5">2eaae519cac1143bcf583636a745381f</checksum>
			<action when="after" seq="1">
				<line verbos="yes">make distclean</line>
				<line verbos="yes">make defconfig</line>
				<line verbos="yes">make busybox</line>
				<line verbos="yes">make install</line>
				
				<line>cp -R _install/* $PROJECT__RFS</line>
				<line>rm -f $PROJECT__RFS/linuxrc</line>
			</action>
		</entry>
	</phase>
	
	
	<phase seq="2" comment="XML library and tools" disabled="yes">
		<entry name="nettle-3.2" type="package/src" seq="1" cdto="yes" download="yes" extract="yes">
			<link>https://ftp.gnu.org/gnu/nettle/nettle-3.2.tar.gz</link>
		    <filename>nettle-3.2.tar.gz</filename>
		    <version>3.2</version>
		    <checksum type="md5">afb15b4764ebf1b4e6d06c62bd4d29e4</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">./configure --prefix=$PROJECT__RFS/usr --disable-static</line>
                <line verbos="yes">make &amp;&amp; make install</line>
            </action>
		</entry>
		
		<entry name="gnutls-3.5.3" type="package/src" seq="1" cdto="yes" download="yes" extract="yes">
			<link>ftp://ftp.gnutls.org/gcrypt/gnutls/v3.5/gnutls-3.5.3.tar.xz</link>
		    <filename>gnutls-3.5.3.tar.xz</filename>
		    <version>3.5.3</version>
		    <checksum type="md5">6c2c7f40ddf52933ee3ca474cb8cb63c</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">./configure --prefix=$PROJECT__RFS/usr --with-included-libtasn1 --with-default-trust-store-file=$PROJECT__RFS/etc/ssl/ca-bundle.crt</line>
                <line verbos="yes">make &amp;&amp; make install</line>
                
                <line verbos="yes">exit -1</line>
            </action>
		</entry>
		
		<entry name="libgcrypt-1.7.3" type="package/src" seq="2" cdto="yes" download="yes" extract="yes">
			<link>ftp://ftp.gnupg.org/gcrypt/libgcrypt/libgcrypt-1.7.3.tar.bz2</link>
		    <filename>libgcrypt-1.7.3.tar.bz2</filename>
		    <version>1.7.3</version>
		    <checksum type="md5">c869e542cc13a1c28d8055487bf7f5c4</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">./configure --prefix=$PROJECT__RFS &amp;&amp; make</line>
                <line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="expat-2.2.0" type="package/src" seq="3" cdto="yes" download="yes" extract="yes">
			<link>ftp://ftp.gnupg.org/gcrypt/libgcrypt/libgcrypt-1.7.3.tar.bz2</link>
		    <filename>expat-2.2.0.tar.bz2</filename>
		    <version>2.2.0</version>
		    <checksum type="md5">2f47841c829facb346eb6e3fab5212e2</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=$PROJECT__RFS --disable-static</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="zlib-1.2.8" type="package/src" seq="4" cdto="yes" download="yes" extract="yes">
			<link>https://sourceforge.net/projects/libpng/files/zlib/1.2.8/zlib-1.2.8.tar.xz/download</link>
		    <filename>zlib-1.2.8.tar.xz</filename>
		    <version>1.2.8</version>
		    <checksum type="md5">28f1205d8dd2001f26fec1e8c2cebe37</checksum>
            <action when="after" seq="1">
                <line verbos="yes">./configure --prefix=$PROJECT__RFS</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="Python-2.7.12.tar.xz" type="package/src" seq="5" cdto="yes" download="yes" extract="yes">
			<link>https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tar.xz</link>
		    <filename>Python-2.7.12.tar.xz</filename>
		    <version>2.7.12</version>
		    <checksum type="md5">57dffcee9cee8bb2ab5f82af1d8e9a69</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
					./configure --prefix=$PROJECT__RFS   \
								--enable-shared          \
								--with-system-expat      \
								--enable-unicode=ucs4
            	</line>
            	<line verbos="yes">make</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">chmod -v 755 $PROJECT__RFS/lib/libpython2.7.so.1.0</line>
            </action>
		</entry>
		
		<entry name="libxml2-2.9.4" type="package/src" seq="6" cdto="yes" download="yes" extract="yes">
			<link>http://xmlsoft.org/sources/libxml2-2.9.4.tar.gz</link>
		    <filename>libxml2-2.9.4.tar.gz</filename>
		    <version>2.9.4</version>
		    <checksum type="md5">ae249165c173b1ff386ee8ad676815f5</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i "/seems to be moved/s/^/#/" ltmain.sh</line>
				<line verbos="yes">./configure --prefix=$PROJECT__RFS --disable-static --with-history</line>
            	<line verbos="yes">make</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">cp -R $PROJECT__RFS/include/libxml2/libxml $PROJECT__RFS/include/</line>
            </action>
		</entry>
		
		<entry name="libxslt-1.1.29" type="package/src" seq="7" cdto="yes" download="yes" extract="yes">
			<link>http://xmlsoft.org/sources/libxslt-1.1.29.tar.gz</link>
		    <filename>libxslt-1.1.29.tar.gz</filename>
		    <version>1.1.29</version>
		    <checksum type="md5">a129d3c44c022de3b9dcf6d6f288d72e</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i "/seems to be moved/s/^/#/" ltmain.sh</line>
				<line verbos="yes">./configure --prefix=$PROJECT__RFS --disable-static</line>
            	<line verbos="yes">make</line>
                <line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="xmlstarlet-1.6.1" type="package/src" seq="8" cdto="yes" download="yes" extract="yes">
			<link>https://sourceforge.net/projects/xmlstar/files/xmlstarlet/1.6.1/xmlstarlet-1.6.1.tar.gz/download</link>
		    <filename>xmlstarlet-1.6.1.tar.gz</filename>
		    <version>1.6.1</version>
		    <checksum type="md5">f3c5dfa3b1a2ee06cd57c255cc8b70a0</checksum>
            <action when="after" seq="1">
                <line verbos="yes">./configure --prefix=$PROJECT__RFS --enable-ipv6=no</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">ln -sf ./xml $PROJECT__RFS/bin/xmlstarlet</line>
            </action>
		</entry>
		
		<entry name="bc-1.06.95" type="package/src" seq="9" cdto="yes" download="yes" extract="yes">
			<link>http://alpha.gnu.org/gnu//bc/bc-1.06.95.tar.bz2</link>
		    <filename>bc-1.06.95.tar.bz2</filename>
		    <version>1.06.95</version>
		    <checksum type="md5">5126a721b73f97d715bb72c13c889035</checksum>
            <action when="after" seq="1">
                <line verbos="yes">./configure --prefix=$PROJECT__RFS</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make install</line>
            </action>
		</entry>
	</phase>
	
</build>

