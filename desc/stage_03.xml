<?xml version="1.0"?>

<build subject="filesystem" stage="02" envpath="/tools/bin:/bin:/usr/bin" runbysudo="yes">

	<phase seq="1">
		<entry type="script/bash" seq="1">
		
			<action when="before" seq="1">
				<line verbose="yes">rm -rf $PROJECT__BLD/*</line>
			</action>
			
			<action when="before" seq="2">
				<line verbose="yes">mkdir -pv $PROJECT__RFS/{dev,proc,sys,run}</line>
				
				<line verbose="yes">mknod -m 600 $PROJECT__RFS/dev/console c 5 1</line>
				<line verbose="yes">mknod -m 666 $PROJECT__RFS/dev/null c 1 3</line>
				
				<line verbose="yes">mount -v --bind /dev $PROJECT__RFS/dev</line>
				<line verbose="yes">mount -vt devpts devpts $PROJECT__RFS/dev/pts -o gid=5,mode=620</line>
				<line verbose="yes">mount -vt proc proc $PROJECT__RFS/proc</line>
				<line verbose="yes">mount -vt sysfs sysfs $PROJECT__RFS/sys</line>
				<line verbose="yes">mount -vt tmpfs tmpfs $PROJECT__RFS/run</line>
				
				<line verbose="yes">
					if [[ -h $PROJECT__RFS/dev/shm ]]; then
						mkdir -pv $PROJECT__RFS/$(readlink $PROJECT__RFS/dev/shm)
					fi
				</line>
				
				<line verbose="yes">exec /tools/bin/bash --login +h</line>
			</action>
			
		</entry>
	</phase>
	
</build>

