<?xml version="1.0"?>

<build name="gognos" type="live" arch="x86_64" version="0.0.2" subject="base" in-chroot="yes" codename="alah">

	<phase seq="1" comment="Base system">
	
		<entry name="linux-4.4.6" type="package/src" seq="1" cdto="yes" download="no" extract="yes">
			<link>https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.4.6.tar.xz</link>
			<filename>linux-4.4.6.tar.xz</filename>
			<version>4.4.6</version>
			<checksum type="md5">efc822dad2149e40cc908718a4fea1d3</checksum>
			<action when="after" seq="1">
				<line verbos="yes">make mrproper</line>
				<line verbos="yes">make defconfig</line>
				<line>sed -i "s/.*CONFIG_DEFAULT_HOSTNAME.*/CONFIG_DEFAULT_HOSTNAME=\"$PROJECT__NAME\"/" .config</line>
				<line verbos="yes">make bzImage</line>
				<line verbos="yes">make headers_install</line>
			</action>
		</entry>
		
		<entry name="glibc-2.24" type="package/src" seq="2" cdto="yes" download="no" extract="yes">
			<link>http://ftp.gnu.org/gnu/glibc/glibc-2.24.tar.xz</link>
			<filename>glibc-2.24.tar.xz</filename>
			<version>2.24</version>
			<checksum type="md5">97dc5517f92016f3d70d83e3162ad318</checksum>
			<action when="after" seq="1">
				<line>mkdir ./glibc_objects</line>
				<line>mkdir ./glibc_installed</line>
				<line>GLIBC_INSTALLED=$(pwd)/glibc_installed</line>
				<line>cd ./glibc_objects</line>
				<line verbos="yes">../configure --prefix= --with-headers=$PROJECT__BLD/linux-4.4.6/usr/include --disable-werror</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install DESTDIR=$GLIBC_INSTALLED</line>
				
				<line>mkdir -vp $PROJECT__RFS/lib</line>
				
				<line>cp $GLIBC_INSTALLED/lib/ld-linux* $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libm.so.6 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libc.so.6 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libresolv.so.2 $PROJECT__RFS/lib</line>
				<line>cp $GLIBC_INSTALLED/lib/libnss_dns.so.2 $PROJECT__RFS/lib</line>
			</action>
		</entry>
		
		<entry name="busybox-1.24.2" type="package/src" seq="3" cdto="yes" download="no" extract="yes">
			<link>http://busybox.net/downloads/busybox-1.24.2.tar.bz2</link>
			<filename>busybox-1.24.2.tar.bz2</filename>
			<version>1.24.2</version>
			<checksum type="md5">2eaae519cac1143bcf583636a745381f</checksum>
			<action when="after" seq="1">
				<line verbos="yes">make distclean</line>
				<line verbos="yes">make defconfig</line>
				<line verbos="yes">make busybox</line>
				<line verbos="yes">make install</line>
				
				<line>cp -R _install/* $PROJECT__RFS</line>
				<line>rm -f $PROJECT__RFS/linuxrc</line>
			</action>
		</entry>
	</phase>
	
</build>

